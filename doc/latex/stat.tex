\clearpage
\section{The Statistics}
\label{sec:stat}

We provide a simple framework for collecting statistics during simulation.
Statistics can be either global (common counter for all cores) or per core
(each core has its own counter).

\subsection{Statistic Types}

The following statistic types are supported:

\begin{description}

  \item [COUNT] for counting the number of occurances of an event. Eg. number
  of cache hits. 

  \item [RATIO] for calculating the ratio of number of occurances of one event
  over another. Eg. (number of cache hits / number of cache accesses) i.e.,
  cache hit ratio.

  \item [DIST]  for defining a group of related events and calculating the
  number of occurances of each event in the as a percent of the sum of the
  number of occurances of all events in the group.  Eg. If we want to know what
  percent of L1 data cache accesses (in a 2-level hierarchy) resulted in L1
  hits, L2 hits or memory accesses, we should define a distribution consisting
  on three events - L1 hits, L2 hits and L2 misses  - and update the
  counter for each event correctly. 

\end{description}


Note that the simulation will output two values for each statistic. One is the
raw value i.e. the number of occurances of the statistic and the other output
value is the value calculated based on the type of the statistic.


\subsection{How to add a new stat}

New statistics can be defined by adding definitions to any of the
\textit{*.stat.def} files in the \textit{trunk/def/} directory or by creating a
\textit{.stat.def} file including the definitions in the \textit{trunk/def/}
directory.  In order to define a per core statistic specify PER\_CORE at the
end of each DEF\_STAT statement below.


\smallskip
\begin{description}

\item[COUNT Stat:] 
\begin{lstlisting}
 DEF_STAT(STAT_NAME, COUNT, NO_RATIO [, PER_CORE])
\end{lstlisting}

Eg: 
\begin{lstlisting}
DEF_STAT(INST_COUNT_TOT, COUNT, NO_RATIO)
DEF_STAT(INST_COUNT, COUNT, NO_RATIO, PER_CORE)
\end{lstlisting}

\item[RATIO Stat:] 
\begin{lstlisting}
DEF_STAT(STAT_NAME, RATIO, BASE_STAT_NAME [, PER_CORE])
\end{lstlisting}

In addition to defining the RATIO stat itself, a base stat of type COUNT has to
be defined as well. The value of the base stat is used as the denominator in
calculating the ratio. 

Eg: 
\begin{lstlisting}
DEF_STAT(DISPATCHED_INST, COUNT, NO_RATIO)
DEF_STAT(DISPATCH_WAIT, RATIO, DISPATCHED_INST)
\end{lstlisting}

\item[DIST Stat:] 
\begin{lstlisting}
DEF_STAT(STAT_NAME_START, DIST, NO_RATIO [, PER_CORE])
DEF_STAT(STAT_NAME, COUNT, NO_RATIO [, PER_CORE])*
DEF_STAT(STAT_NAME_END, DIST, NO_RATIO [, PER_CORE])
\end{lstlisting}

The definition of a DIST stat requires at least two stats.

Eg: 
\begin{lstlisting}
DEF_STAT(SCHED_FAILED_REASON_SUCCESS, DIST, NO_RATIO, PER_CORE)
DEF_STAT(SCHED_FAILED_OPERANDS_NOT_READY, COUNT, NO_RATIO, PER_CORE)
DEF_STAT(SCHED_FAILED_NO_PORTS, DIST, NO_RATIO, PER_CORE)
\end{lstlisting}

\end{description}


\smallskip



\subsection{How to update statistics}

\smallskip

Macros are provided to update the value of statistics. STAT\_EVENT and
STAT\_EVENT\_M increment and decrement the value of a global statistic by 1 and
take the name of the stat to be updated as their one and only argument.
STAT\_EVENT\_N is used to increment the value of a global statistic by more
than than 1. It takes the name of the statistic to be incremented and the value
by which the statistic is to be incremented as its parameters.
STAT\_CORE\_EVENT and STAT\_CORE\_EVENT\_M increment and decrement the value of
a per core stat by 1. These take core id and the name of the statistic to be
incremented/decremented as their parameters.

Eg:
\begin{lstlisting}
STAT_EVENT(INST_COUNT_TOT)
STAT_EVENT_N(INST_COUNT_TOT, 2)
STAT_CORE_EVENT(1, INST_COUNT)
\end{lstlisting}
\smallskip


\subsection{The Output}

At the end of the simulation *.stat.out are generated, these files include the
statistic values at the end of the simulation. As mentioned, for each stat two
values are generated, one is the raw statistic value and other is a value
calculated based on the type of the stat.



\subsection{Important Stats}

\begin{table}[htb]
\begin{center}
\caption{Important Stats} 
\label{table:stats}
\begin{tabular}{|p{2in}||p{2.5in}|p{0.5in}|p{1in}|}
\hline 
INST\_COUNT\_TOT & \# of instructions &  & general.stat.out  \\ \hline 
INST\_COUNT\_CORE\_[0-11] & \# of instructions in only the specificed core [0-11] & core  & general.stat.out  \\ \hline 
CYC\_COUNT\_TOT &  simulated cycles &  & general.stat.out \\ \hline 
CYC\_COUNT\_CORE\_[0-11] & simulated cycles in only the specificed core [0-11]&  & general.stat.out \\ \hline 
CYC\_COUNT\_X86 & simulated cycles for x86 only &  & general.stat.out \\ \hline 
CYC\_COUNT\_PTX & simulated cycles for ptx only &  & general.stat.out \\ \hline \hline 

                & \# of fp instructions &   &  \\ \hline 
                & \# of int instructions &   &  \\ \hline 
                & \# of load instructions &   &  \\ \hline  
                & \# of store instructions &   &  \\ \hline  

BP\_ON\_PATH\_CORRECT                & \# of correctly predicted branches (DIST) &  core  & bp.stat.def \\ \hline  
BP\_ON\_PATH\_MISPREDICT                & \# of mis-predicted branches (DIST) &  core  & bp.stat.def \\ \hline  
BP\_ON\_PATH\_MISFETCHT                & \# of mis-fetch branches (BTB MISS)(DIST) &  core  & bp.stat.def \\ \hline  
                
ICACHE\_HIT, ICACHE\_MISS                & \# of I-cache hitt,miss (DIST) &   & memory.stat.def  \\ \hline  
L[1-3]\_HIT\_CPU                & \# of l[1-3]cache hits from CPU &   & memory.stat.def \\ \hline 
L[1-3]\_HIT\_GPU                & \# of l[1-3]cache hits from GPU &   & memory.stat.def \\ \hline 
L[1-3]\_MISS\_CPU                & \# of l[1-3]cache misses from CPU &   & memory.stat.def \\ \hline 
L[1-3]\_MISS\_GPU                & \# of l[1-3]cache misses from GPU &   & memory.stat.def \\ \hline  \hline 

${AVG\_MEMORY\_LATENCY}/{AVG_MEMORY\_LATENCY\_BASE}$ & average memory latency &   & memory. stat.def \\ \hline \hline 
TOTAL\_DRAM                & \# of DRAM accesses&   & memory.stat.def \\ \hline  
TOTAL\_DRAM\_READ                & \# of DRAM reads &   & memory.stat.def \\ \hline  
TOTAL\_DRAM\_WB                 & \# of DRAM write backs &   & memory.stat.def \\ \hline  
                & \# of register reads &   &  \\ \hline  
                & \# of register writes  &   &  \\ \hline   \hline 

COAL\_INST, UNCOAL\_INST & coalesced/uncoalesced mem requests (DIST) &   & memory.stat.def  \\ \hline 




\end{tabular}
\end{center}
\end{table} 


